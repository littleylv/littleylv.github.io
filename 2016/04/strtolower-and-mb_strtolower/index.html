<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.siuwing.me","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="4月13日。 昨天发现在执行搜索的时候，如果搜索关键词带有如 ãé 这样的字符的时候会报错。 起初以为是solr和tomcat配置的问题，但是检查发现tomcat配置的编码是utf8是没问题。而且正式服务器上并不会有问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="strtolower 和 mb_strtolower 的区别">
<meta property="og:url" content="https://www.siuwing.me/2016/04/strtolower-and-mb_strtolower/index.html">
<meta property="og:site_name" content="十月初壹">
<meta property="og:description" content="4月13日。 昨天发现在执行搜索的时候，如果搜索关键词带有如 ãé 这样的字符的时候会报错。 起初以为是solr和tomcat配置的问题，但是检查发现tomcat配置的编码是utf8是没问题。而且正式服务器上并不会有问题。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-04-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-12-02T13:12:00.840Z">
<meta property="article:author" content="Siuwing Leoi">
<meta property="article:tag" content="php">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.siuwing.me/2016/04/strtolower-and-mb_strtolower/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.siuwing.me/2016/04/strtolower-and-mb_strtolower/","path":"2016/04/strtolower-and-mb_strtolower/","title":"strtolower 和 mb_strtolower 的区别"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>strtolower 和 mb_strtolower 的区别 | 十月初壹</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?73832f787ac884418e31b5143b3a52c6"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">十月初壹</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-collections"><a href="/collections/" rel="section"><i class="fa fa-star fa-fw"></i>收藏</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Siuwing Leoi"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Siuwing Leoi</p>
  <div class="site-description" itemprop="description">十月初壹</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/littleylv" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;littleylv" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zcy4089@gmail.com" title="E-Mail → mailto:zcy4089@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/zcy4089" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;zcy4089" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/9903955/littleylv" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9903955&#x2F;littleylv" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.siuwing.me/2016/04/strtolower-and-mb_strtolower/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Siuwing Leoi">
      <meta itemprop="description" content="十月初壹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十月初壹">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          strtolower 和 mb_strtolower 的区别
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-04-13 00:00:00" itemprop="dateCreated datePublished" datetime="2016-04-13T00:00:00+08:00">2016-04-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-12-02 21:12:00" itemprop="dateModified" datetime="2021-12-02T21:12:00+08:00">2021-12-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WORK/" itemprop="url" rel="index"><span itemprop="name">WORK</span></a>
        </span>
    </span>

  
    <span id="/2016/04/strtolower-and-mb_strtolower/" class="post-meta-item leancloud_visitors" data-flag-title="strtolower 和 mb_strtolower 的区别" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2016/04/strtolower-and-mb_strtolower/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/strtolower-and-mb_strtolower/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>4月13日。</p>
<p>昨天发现在执行搜索的时候，如果搜索关键词带有如 <code>ãé</code> 这样的字符的时候会报错。</p>
<p>起初以为是solr和tomcat配置的问题，但是检查发现tomcat配置的编码是utf8是没问题。而且正式服务器上并不会有问题。</p>
<span id="more"></span>

<p>另外奇怪的是，使用的是同一个tomcat+solr的服务器，在3个环境（测试+开发）下是不一样的：</p>
<pre><code>A: centos=6.5, php=5.4.16
B: windows=7, php=5.4.12
C: osx=10.11, php=5.5.33
</code></pre>
<p>只有B下面不会报错。</p>
<p>经过B和C下两台电脑的调试，发现传给solr时候的关键词对于 <code>ãé</code> 字符的编码并不一样，原来是在这里对搜索字符串做了 <code>strtolower</code> 导致。测试信息如下：</p>
<pre><code>$foo = &#39;This is é&#39;;
pr(&#39;Normal: &#39;.$foo);    // Normal: This is é
pr(&#39;After strtolower: &#39;.strtolower($foo));    // After strtolower: this is �
</code></pre>
<p>导致传给solr的字符串带有无法解析utf8的乱码，tomcat报错：<code>Invalid character encoding detected after position 482 of query string / form data (while parsing as UTF-8)</code>。</p>
<p>解决办法是把<code>strtolower</code>换成<code>mb_strtolower</code>：</p>
<pre><code>$foo = &#39;This is é&#39;;
pr(&#39;Normal: &#39;.$foo);    // Normal: This is é
pr(&#39;After strtolower: &#39;.strtolower($foo));    // After strtolower: this is �
pr(&#39;After mb_strtolower: &#39;.mb_strtolower($foo));    // After mb_strtolower: this is é
</code></pre>
<p>问题解决。</p>
<p>PHP手册对于<code>mb_strtolower</code>的解释：</p>
<pre><code>string mb_strtolower ( string $str [, string $encoding = mb_internal_encoding() ] )

Returns str with all alphabetic characters converted to lowercase.

str
    The string being lowercased.
encoding
    The encoding parameter is the character encoding. If it is omitted, the internal character encoding value will be used.
    
By contrast to strtolower(), &#39;alphabetic&#39; is determined by the Unicode character properties. Thus the behaviour of this function is not affected by locale settings and it can convert any characters that have &#39;alphabetic&#39; property, such as A-umlaut (Ä).
</code></pre>
<p>至于为什么正式服务器和B电脑不会有这个问题，悬而未决，等后面找到再补充吧 :(</p>
<p>完。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/php/" rel="tag"># php</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2016/03/wkhtmltopdf-and-apache-privetetmp/" rel="prev" title="wkhtmltopdf和apache的tmp目录问题">
                  <i class="fa fa-chevron-left"></i> wkhtmltopdf和apache的tmp目录问题
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2016/08/linux-commands/" rel="next" title="常用Linux命令">
                  常用Linux命令 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Siuwing Leoi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  




  <script src="/js/third-party/pace.js"></script>

  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"mxgxbwWFscYQ4jdd0tpq1RiH-MdYXbMMI","app_key":"IGrGz1kMFH7qX8nWlIKQKUNn","server_url":null,"security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"LittleyLv","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
